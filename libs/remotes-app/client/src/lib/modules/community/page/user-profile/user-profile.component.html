<div class="h-56 rounded-lg bg-indigo-200 p-10">
  <div class="rounded-2xl flex items-center justify-between w-full gap-8 px-8 py-10">
    <img class="h-48 w-48 border-3 border-white rounded-full flex-shrink-0"
         [src]="userProfile.avatarUrl || 'https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y'" />
    <div class="flex flex-grow gap-2 justify-between items-start">
      <div class="flex flex-col justify-start">
        <h3 class="text-lg font-semibold leading-7 tracking-tight">
          {{ userProfile.email }}
        </h3>
        <p class="text-base leading-6 text-gray-400">Number of Pages: {{ posts.length}}</p>
      </div>

      <div class="flex items-center gap-2">
        <ng-container *ngTemplateOutlet="followerInfo"></ng-container>
        <button type="button"
                [class.bg-blue-700]="isFollowing"
                [class.bg-gray-700]="!isFollowing"
                class="text-white flex gap-2 items-center  focus:outline-none rounded-lg text-sm px-5 py-2"
                (click)="followUser(userProfile._id||'')">
          <span>{{isFollowing ? "Unfollow" : "Follow" }}</span>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="bg-white py-24">
  <div class="mx-auto max-w-7xl px-20">
    <ng-container *ngIf="posts && posts.length > 0; else emptyTemplate">
      <div class="mx-auto mt-4 grid max-w-2xl auto-rows-fr grid-cols-1 gap-8 lg:mx-0 lg:max-w-none lg:grid-cols-3">
        <article *ngFor="let post of posts"
                 class="relative isolate flex flex-col justify-end overflow-hidden rounded-2xl bg-gray-900 px-8 pb-8 pt-80 sm:pt-48 lg:pt-80">
          <iframe width="100%"
                  height="400px"
                  frameborder="0"
                  cellspacing="0"
                  scrolling="no"
                  style="pointer-events: none; overflow: hidden"
                  [src]="post.pageUrl | safe"
                  class="absolute inset-0 -z-10 h-full w-full object-cover"></iframe>

          <div class="absolute inset-0 -z-10 bg-gradient-to-t from-gray-900 via-gray-900/40"></div>
          <div class="absolute inset-0 -z-10 rounded-2xl ring-1 ring-inset ring-gray-900/10"></div>

          <div class="flex flex-wrap items-center gap-y-1 overflow-hidden text-sm leading-6 text-gray-300">
            <time datetime="2020-03-16"
                  class="mr-8">{{
              post.createdAt | date
            }}</time>
          </div>

          <h3 class="mt-3 text-left text-lg font-semibold leading-6 text-white">
            <a (click)="openPreview(post.pageUrl)">
              <span class="absolute inset-0"></span>
              {{ post.title }}
            </a>
          </h3>
          <p class="mt-3 line-clamp-3 text-xs leading-6 text-gray-600">
            {{ post.content }}
          </p>
        </article>
      </div>
    </ng-container>
  </div>
</div>

<ng-template #emptyTemplate>
  <main class="mx-auto flex w-full max-w-7xl flex-auto flex-col justify-center text-center">
    <p class="mt-6 text-base leading-7 text-gray-600">
      No posts found for this user.
    </p>
  </main>
</ng-template>

<ng-template #followerInfo>
  <div class="flex gap-2 justify-center">
    <p [class]="
          'text-sm leading-6 text-gray-400 p-2 rounded-md cursor-pointer ' +
          (selectedFollowTab === FollowList.Followers
            ? 'border-b-2 rounded-none border-indigo-600 bg-transparent'
            : 'bg-white')
        "
       (click)="viewDetailFollow(FollowList.Followers)">
      {{ followers?.length || 0 }} Followers
    </p>
    <p [class]="
          'text-sm leading-6 text-gray-400 p-2  rounded-md cursor-pointer ' +
          (selectedFollowTab === FollowList.Following
            ? 'border-b-2 rounded-none border-indigo-600 bg-transparent'
            : 'bg-white')
        "
       (click)="viewDetailFollow(FollowList.Following)">
      {{ following?.length || 0 }} Following
    </p>
  </div>
</ng-template>


<cwp-model-layout *ngIf="detailFollowVisible">
  <div class="p-4">
    <div class="h-full p-4">
      <ng-container *ngTemplateOutlet="followerInfo"></ng-container>
      <ul role="list"
          class="mt-4 divide-y divide-gray-200 border-b border-t border-gray-200">
        <li *ngFor="let user of followList"
            class="flex items-center justify-between space-x-3 py-4">
          <div class="flex min-w-0 flex-1 items-center space-x-3">
            <div class="flex-shrink-0">
              <img *ngIf="user?.avatarUrl"
                   class="h-10 w-10 rounded-full"
                   [src]="user?.avatarUrl" />
              <div *ngIf="!user?.avatarUrl"
                   class="h-10 w-10 rounded-full flex items-center justify-center font-bold uppercase bg-slate-200">
                {{ user?.email.length > 0 ? (user?.email)[0] : "U" }}
              </div>
            </div>
            <div class="min-w-0 flex-1">
              <p class="truncate text-sm font-medium text-gray-900">
                {{ user?.email }}
              </p>
            </div>
          </div>
          <div class="flex-shrink-0">
            <button type="submit"
                    (click)="followUser(user.id)"
                    [class]="
                    'inline-flex items-center gap-x-1.5 text-sm font-medium' +
                    (user.isFollowed
                      ? ' text-gray-800 cursor-default'
                      : ' text-red-800 hover:text-red-900 cursor-pointer')
                  ">
              {{ user.isFollowed ? "Followed" : "Unfollow" }}
            </button>
          </div>
        </li>
      </ul>
    </div>
  </div>
</cwp-model-layout>
